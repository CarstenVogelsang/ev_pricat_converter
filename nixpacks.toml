# Nixpacks configuration for Coolify deployment
# https://nixpacks.com/docs/configuration/file

providers = ["python"]

[phases.setup]
aptGet = false

[start]
# DB_RESET=true triggers full database reset (drop all tables, recreate, seed)
# Without DB_RESET: normal migration workflow
cmd = "if [ \"$DB_RESET\" = \"true\" ]; then echo '=== DB_RESET=true: Resetting database... ===' && flask reset-db && flask seed && flask seed-users; else flask db upgrade && flask seed && flask seed-users; fi && gunicorn -w 4 -b 0.0.0.0:3000 'app:create_app()'"
