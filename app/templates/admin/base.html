{% import 'admin/layout.html' as layout with context -%}
{% import 'admin/static.html' as admin_static with context %}
<!DOCTYPE html>
<html lang="de">
<head>
    <title>{% block title %}{{ admin_view.name }} - DB Admin{% endblock %}</title>
    {% block head_meta %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% endblock %}
    {% block head_css %}
    <!-- Bootstrap 5 + Tabler Icons (like main app) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='tabler-icons/tabler-icons.min.css') }}">
    <!-- Flask-Admin CSS (needed for forms, tables) -->
    <link href="{{ admin_static.url(filename='admin/css/bootstrap4/admin.css', v='1.1.1') }}" rel="stylesheet">
    <link href="{{ admin_static.url(filename='vendor/select2/select2.min.css', v='4.0.13') }}" rel="stylesheet">
    <link href="{{ admin_static.url(filename='vendor/select2/select2-bootstrap-5-theme.min.css', v='1.3.0') }}" rel="stylesheet">
    {% if admin_view.extra_css %}
    {% for css_url in admin_view.extra_css %}
    <link href="{{ css_url }}" rel="stylesheet">
    {% endfor %}
    {% endif %}
    <style>
        :root {
            --bs-primary: {{ branding.primary_color }};
            --bs-secondary: {{ branding.secondary_color }};
        }
        /* Sidebar styles */
        .admin-sidebar .list-group-item-action {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
        }
        .admin-sidebar .list-group-item-action i {
            flex-shrink: 0;
            line-height: 1.5;
        }
        .admin-sidebar .list-group-item-action span {
            flex: 1;
        }
        .admin-sidebar .list-group-item.active {
            background-color: {{ branding.primary_color }};
            border-color: {{ branding.primary_color }};
        }
        /* Branding colors */
        .btn-primary {
            background-color: {{ branding.primary_color }} !important;
            border-color: {{ branding.primary_color }} !important;
        }
        .btn-primary:hover {
            background-color: {{ branding.primary_color }} !important;
            border-color: {{ branding.primary_color }} !important;
            filter: brightness(90%);
        }
        a { color: {{ branding.primary_color }}; }
        a:hover { color: {{ branding.secondary_color }}; }
        /* Flask-Admin table tweaks */
        .table a { color: {{ branding.primary_color }}; }
        .table-hover tbody tr:hover { background-color: #f5f5f5; }
        /* Category headers in sidebar */
        .sidebar-category {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #6c757d;
            padding: 0.5rem 1rem;
            margin-top: 0.5rem;
            border-bottom: 1px solid #dee2e6;
        }
        /* Admin content area */
        .admin-content {
            min-height: calc(100vh - 2rem);
        }
    </style>
    {% endblock %}
    {% block head %}{% endblock %}
    {% block head_tail %}{% endblock %}
</head>
<body>
{% block page_body %}
<div class="container-fluid py-3">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-3 col-lg-2">
            <div class="card admin-sidebar">
                <div class="card-header" style="background-color: {{ branding.primary_color }}; color: white;">
                    <h6 class="mb-0"><i class="ti ti-database"></i> DB Admin</h6>
                </div>
                <div class="list-group list-group-flush">
                    <!-- Back to Admin Dashboard -->
                    <a href="{{ url_for('admin.index') }}" class="list-group-item list-group-item-action">
                        <i class="ti ti-arrow-left"></i><span>Zurueck zum Admin</span>
                    </a>

                    <!-- Dynamic menu from Flask-Admin -->
                    {% for item in admin_view.admin.menu() %}
                        {% if item.is_category() %}
                            <div class="sidebar-category">{{ item.name }}</div>
                            {% for subitem in item.get_children() %}
                                {% if subitem.is_accessible() %}
                                <a href="{{ subitem.get_url() }}"
                                   class="list-group-item list-group-item-action{% if subitem.is_active(admin_view) %} active{% endif %}">
                                    {% if subitem.name == 'Lieferanten' %}<i class="ti ti-truck"></i>
                                    {% elif subitem.name == 'Hersteller' %}<i class="ti ti-building-factory"></i>
                                    {% elif subitem.name == 'Marken' %}<i class="ti ti-tag"></i>
                                    {% elif subitem.name == 'Kunden' %}<i class="ti ti-users"></i>
                                    {% elif subitem.name == 'Branchen' %}<i class="ti ti-category"></i>
                                    {% elif subitem.name == 'Verb√§nde' %}<i class="ti ti-building-community"></i>
                                    {% elif subitem.name == 'Users' %}<i class="ti ti-user"></i>
                                    {% elif subitem.name == 'Config' %}<i class="ti ti-settings"></i>
                                    {% else %}<i class="ti ti-database"></i>
                                    {% endif %}
                                    <span>{{ subitem.name }}</span>
                                </a>
                                {% endif %}
                            {% endfor %}
                        {% elif item.is_accessible() and not item.is_category() %}
                            <a href="{{ item.get_url() }}"
                               class="list-group-item list-group-item-action{% if item.is_active(admin_view) %} active{% endif %}">
                                <i class="ti ti-home"></i><span>{{ item.name }}</span>
                            </a>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Content -->
        <div class="col-md-9 col-lg-10">
            <div class="admin-content">
                {% block messages %}
                {{ layout.messages() }}
                {% endblock %}

                {% set render_ctx = h.resolve_ctx() %}
                {% block body %}{% endblock %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block tail_js %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="{{ admin_static.url(filename='vendor/jquery.min.js', v='3.5.1') }}" type="text/javascript"></script>
<script src="{{ admin_static.url(filename='vendor/moment.min.js', v='2.29.1') }}" type="text/javascript"></script>
<script src="{{ admin_static.url(filename='vendor/select2/select2.min.js', v='4.0.13') }}" type="text/javascript"></script>
{% if admin_view.extra_js %}
{% for js_url in admin_view.extra_js %}
<script src="{{ js_url }}" type="text/javascript"></script>
{% endfor %}
{% endif %}
{% endblock %}
{% block tail %}{% endblock %}
</body>
</html>
