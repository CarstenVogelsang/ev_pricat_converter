{% extends "administration/base.html" %}
{% from "macros/breadcrumb.html" import breadcrumb %}

{% block title %}Excel-Export - Schulungen - {{ branding.app_title }}{% endblock %}

{% block admin_content %}
{{ breadcrumb([
    {'label': 'Administration', 'url': url_for('admin.index'), 'icon': 'ti-settings'},
    {'label': 'Module', 'url': url_for('admin.module_uebersicht'), 'icon': 'ti-apps'},
    {'label': 'Schulungen', 'url': url_for('schulungen_admin.index'), 'icon': 'ti-school'},
    {'label': 'Excel-Export', 'icon': 'ti-file-spreadsheet'}
]) }}

<h2 class="mb-4"><i class="ti ti-file-spreadsheet text-success"></i> Excel-Export für ERP</h2>

<div class="row">
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <i class="ti ti-filter"></i> Zeitraum wählen
            </div>
            <div class="card-body">
                <form method="GET">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="von" class="form-label">Von</label>
                            <input type="date" class="form-control" id="von" name="von"
                                   value="{{ von_datum }}">
                        </div>
                        <div class="col-md-6">
                            <label for="bis" class="form-label">Bis</label>
                            <input type="date" class="form-control" id="bis" name="bis"
                                   value="{{ bis_datum }}">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-success">
                        <i class="ti ti-download"></i> Export starten
                    </button>
                </form>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <i class="ti ti-info-circle"></i> Export-Format
            </div>
            <div class="card-body">
                <p>Die Excel-Datei enthält folgende Spalten:</p>
                <ul>
                    <li><strong>Kundennummer</strong> - Aus Kundenstamm</li>
                    <li><strong>Firmenname</strong></li>
                    <li><strong>Schulung</strong> - Titel der Schulung</li>
                    <li><strong>Artikelnummer</strong> - ERP-Artikelnummer</li>
                    <li><strong>Preis</strong> - Preis bei Buchung</li>
                    <li><strong>Buchungsdatum</strong></li>
                    <li><strong>Start-Datum</strong> - Erster Schulungstag</li>
                </ul>
                <p class="text-muted mb-0">
                    <i class="ti ti-filter"></i>
                    Es werden nur Buchungen mit Status "gebucht" exportiert.
                </p>
            </div>
        </div>
    </div>

    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <i class="ti ti-history"></i> Schnellauswahl
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{{ url_for('schulungen_admin.export_buchungen', von=today.replace(day=1).strftime('%Y-%m-%d'), bis=today.strftime('%Y-%m-%d')) }}"
                       class="btn btn-outline-primary">
                        <i class="ti ti-calendar"></i> Aktueller Monat
                    </a>
                    <a href="{{ url_for('schulungen_admin.export_buchungen', von=(today.replace(day=1) - timedelta(days=1)).replace(day=1).strftime('%Y-%m-%d'), bis=(today.replace(day=1) - timedelta(days=1)).strftime('%Y-%m-%d')) }}"
                       class="btn btn-outline-secondary">
                        <i class="ti ti-calendar-minus"></i> Letzter Monat
                    </a>
                    <a href="{{ url_for('schulungen_admin.export_buchungen', von=(today - timedelta(days=today.weekday())).strftime('%Y-%m-%d'), bis=today.strftime('%Y-%m-%d')) }}"
                       class="btn btn-outline-secondary">
                        <i class="ti ti-calendar-week"></i> Aktuelle Woche
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
